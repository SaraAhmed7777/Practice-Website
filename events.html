<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Events | CUNYServe</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans text-gray-800 bg-gray-100">
  <!-- Shared Navbar -->
  <div id="navbar-placeholder"></div>

  <!-- Hero Section -->
  <section class="bg-[#0056b3] text-white text-center py-10 px-4">
    <h2 class="text-3xl font-bold mb-2">Upcoming Volunteer Events</h2>
    <p class="text-lg">Explore civic engagement opportunities across all CUNY campuses and NYC.</p>
  </section>

  <!-- Filter Section -->
  <div class="flex flex-wrap justify-center gap-4 my-6 px-4">
    <select id="campusFilter" class="p-2 rounded border">
      <option value="All">All Campuses</option>
      <option value="Baruch College">Baruch College</option>
      <option value="Queens College">Queens College</option>
      <option value="City College">City College</option>
      <option value="Hunter College">Hunter College</option>
      <option value="Brooklyn College">Brooklyn College</option>
      <option value="BMCC">BMCC</option>
      <option value="CSI">CSI</option>
      <option value="Non-CUNY">Non-CUNY</option>
    </select>
    <select id="typeFilter" class="p-2 rounded border">
      <option value="All">All Types</option>
      <option value="Clean-Up">Clean-Up</option>
      <option value="Tutoring">Tutoring</option>
      <option value="Food Pantry">Food Pantry</option>
      <option value="Donation Drive">Donation Drive</option>
      <option value="Registration Drive">Registration Drive</option>
      <option value="Mentorship">Mentorship</option>
    </select>
    <select id="formatFilter" class="p-2 rounded border">
      <option value="All">All Formats</option>
      <option value="In-Person">In-Person</option>
      <option value="Virtual">Virtual</option>
    </select>
  </div>

  <!-- Events Grid -->
  <div id="eventGrid" class="flex flex-wrap justify-center gap-6 px-4 pb-10"></div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white text-center py-4 mt-8">
    <p>© 2025 CUNYServe. All rights reserved.</p>
    <div class="mt-2">
      <a href="#" class="mx-2 hover:underline">Privacy</a>
      <a href="#" class="mx-2 hover:underline">Terms</a>
      <a href="#" class="mx-2 hover:underline">Contact</a>
    </div>
  </footer>

  <!-- Events Script -->
  <script>
    let events = [];
    const eventGrid = document.getElementById("eventGrid");

    function formatDate(iso) {
      if (!iso) return "";
      const d = new Date(iso + "T00:00:00");
      return d.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
    }

    async function loadEvents() {
      const res = await fetch('data/events.json', { cache: 'no-store' });
      events = await res.json();

      // Sort upcoming first
      events.sort((a, b) => new Date(a.date) - new Date(b.date));
      renderEvents();
    }

    function renderEvents() {
      const campus = document.getElementById("campusFilter").value;
      const type = document.getElementById("typeFilter").value;
      const format = document.getElementById("formatFilter").value;

      const filtered = events.filter(e =>
        (campus === "All" || e.campus === campus) &&
        (type === "All" || e.type === type) &&
        (format === "All" || e.format === format)
      );

      if (filtered.length === 0) {
        eventGrid.innerHTML = "<div class='text-center text-gray-500 italic'>No events match your filters.</div>";
        return;
      }

      eventGrid.innerHTML = filtered.map(e => {
        const dateText = formatDate(e.date);
        const timeText = [e.startTime, e.endTime].filter(Boolean).join("–");
        const desc = e.desc || e.description || "";
        const btn = e.signupUrl ? `
          <a href="${e.signupUrl}" target="_blank" rel="noopener"
             class="mt-3 inline-block text-sm underline">
             Sign up
          </a>` : "";

        return `
          <div class="bg-white rounded-2xl p-5 shadow w-full max-w-sm">
            <h3 class="text-xl font-semibold text-[#0056b3] mb-2">${e.title}</h3>
            <p class="text-sm text-gray-700 mb-2">
              <strong>${dateText}${timeText ? " • " + timeText : ""}</strong> · ${e.campus} · ${e.format}
            </p>
            <p class="text-gray-600">${desc}</p>
            ${btn}
          </div>
        `;
      }).join("");
    }

    document.getElementById("campusFilter").addEventListener("change", renderEvents);
    document.getElementById("typeFilter").addEventListener("change", renderEvents);
    document.getElementById("formatFilter").addEventListener("change", renderEvents);

    loadEvents();
  </script>

  <script src="navbar.js"></script>
</body>
</html>
